function Particle(a){this.x=0,this.y=0,this.xVelocity=0,this.yVelocity=0,this.radius=5,this.context=a,this.draw=function(){if(this.image)return void this.context.drawImage(this.image,leftBound+this.x,topBound+this.y,size,size)},this.update=function(){this.x+=this.xVelocity,this.y+=this.yVelocity,this.x>=canvasWidth?(this.xVelocity=-this.xVelocity,this.x=canvasWidth):this.x<=0&&(this.xVelocity=-this.xVelocity,this.x=0),this.y>=canvasHeight?(this.yVelocity=-this.yVelocity,this.y=canvasHeight):this.y<=0&&(this.yVelocity=-this.yVelocity,this.y=0)},this.setPosition=function(a,b){this.x=a,this.y=b},this.setVelocity=function(a,b){this.xVelocity=a,this.yVelocity=b},this.setImage=function(a){this.image=a}}function generateRandom(a,b){return Math.random()*(b-a)+a}function initMist(a,b,c,d,e,f){var g=document.getElementById("bodyCanvas");if(g.getContext){leftBound=a,rightBound=b,topBound=c,bottomBound=d,size=e,canvasWidth=rightBound-leftBound,canvasHeight=bottomBound-topBound,context=g.getContext("2d"),particles=[],maxVelocity=e/18,particleCount=f;for(var h=0;h<particleCount;++h){var i=new Particle(context);i.setPosition(generateRandom(0,canvasWidth),generateRandom(0,canvasHeight)),i.setVelocity(generateRandom(-maxVelocity,maxVelocity),generateRandom(-maxVelocity,maxVelocity)),particles.push(i)}var j=new Image;j.onload=function(){particles.forEach(function(a){a.setImage(j)})},j.src="img/misc/mist.png"}else alert("Please use a modern browser")}function drawMist(){particles.forEach(function(a){a.draw()})}function updateMist(){particles.forEach(function(a){a.update()})}function initRain(a,b,c,d,e,f){var g=document.getElementById("bodyCanvas");if(g.getContext){rctx=g.getContext("2d"),w=b-a,h=d-c,rlb=a,rtb=c,rctx.strokeStyle="rgba(174,194,224,0.5)",rctx.lineWidth=f,rctx.lineCap="round",init=[],maxParts=e;for(var i=0;i<maxParts;i++)init.push({x:a+Math.random()*w,y:c+Math.random()*h,l:1*Math.random(),xs:4*Math.random()-4+2,ys:10*Math.random()+10});rainParticles=[];for(var j=0;j<maxParts;j++)rainParticles[j]=init[j]}}function drawRain(){for(var a=0;a<rainParticles.length;a++){var b=rainParticles[a];rctx.beginPath(),rctx.moveTo(b.x,b.y),rctx.lineTo(b.x+b.l*b.xs,b.y+b.l*b.ys),rctx.stroke()}move()}function move(){for(var a=0;a<rainParticles.length;a++){var b=rainParticles[a];b.x+=b.xs,b.y+=b.ys,(b.x>rlb+w||b.y>rtb+h)&&(b.x=rlb+Math.random()*w,b.y=rtb-20)}}function run(){animateAllFish(),rippleFrame(),drawRain(),updateMist(),drawMist(),runRequestId=window.requestAnimationFrame(run)}function disturb(a,b){a<<=0,b<<=0;for(var c=b-riprad;c<b+riprad;c++)for(var d=a-riprad;d<a+riprad;d++)ripplemap[oldind+c*width+d]+=128}function rippleFrame(){var a,b,c,d,e,f,g=oldind;oldind=newind,newind=g;for(var h=0,i=width,j=height,k=ripplemap,l=last_map,m=ripple.data,n=texture.data,o=half_width,p=half_height,q=0;q<j;q++)for(var r=0;r<i;r++){var s=newind+h,t=oldind+h;c=k[t-i]+k[t+i]+k[t-1]+k[t+1]>>1,c-=k[s],c-=c>>5,k[s]=c,c=512-c,f=l[h],l[h]=c,f!=c&&(a=((r-o)*c/512<<0)+o,b=((q-p)*c/512<<0)+p,a>=i&&(a=i-1),a<0&&(a=0),b>=j&&(b=j-1),b<0&&(b=0),e=4*(a+b*i),d=4*h,(a<leftBorder-20*ratio||a>rightBorder+40*ratio||b<topBorder-20*ratio)&&(e=d),m[d]=n[e],m[d+1]=n[e+1],m[d+2]=n[e+2]),++h}ctx.putImageData(ripple,0,0)}function animateAllFish(){animateFish(1),animateFish(2)}function animateFish(a){var b,c,d,e,f;1==a?(b=fish1Elem,c=fish1Left,d=fish1Top,e=fish1Direction,f=goingRight1):(b=fish2Elem,c=fish2Left,d=fish2Top,e=fish2Direction,f=goingRight2);var g=8*ratio/a,h=Math.random();if(h<.02){e="straight";var i;i=f?"rotate(0deg)":"rotate(180deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i}else if(h<.04&&d<bottomBorder-50*ratio){e="down";var i;i=f?"rotate(45deg)":"rotate(140deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i}else if(h<.06&&d>topBorder+50*ratio){e="up";var i;i=f?"rotate(315deg)":"rotate(215deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i}if(f){if("up"==e?(c+=.7*g,(d-=.7*g)<topBorder&&(e="down",i="rotate(45deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i)):"down"==e?(c+=.7*g,(d+=.7*g)>bottomBorder&&(e="up",i="rotate(315deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i)):c+=g,c>rightBorder){f=!1;var i;i="up"==e?"rotate(215deg)":"down"==e?"rotate(140deg)":"rotate(180deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i}}else"up"==e?(c-=.7*g,(d-=.7*g)<topBorder&&(e="down",i="rotate(140deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i)):"down"==e?(c-=.7*g,(d+=.7*g)>bottomBorder&&(e="up",i="rotate(215deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i)):c-=g,c<leftBorder&&(f=!0,i="up"==e?"rotate(315deg)":"down"==e?"rotate(45deg)":"rotate(0deg)",b.style.webkitTransform=i,b.style.MozTransform=i,b.style.transform=i);b.style.left=c+"px",b.style.top=d+"px",disturb(c+12*ratio,d+9*ratio),1==a?(fish1Left=c,fish1Top=d,fish1Direction=e,goingRight1=f):(fish2Left=c,fish2Top=d,fish2Direction=e,goingRight2=f)}function initCanvas(){runRequestId&&window.cancelAnimationFrame(runRequestId),canvas=document.getElementById("bodyCanvas"),ctx=canvas.getContext("2d"),width=window.innerWidth,height=window.innerHeight,half_width=width>>1,half_height=height>>1,size=width*(height+2)*2,oldind=width,newind=width*(height+3),step=2*line_width,count=height/line_width,canvas.width=width,canvas.height=height,canvas.style.left="0px",canvas.style.top="0px";ratio=width/1828;var a=height/1080,b=1;if(a>ratio){var c=width/a/1828;document.getElementById("top").style.width=width/c+"px",document.getElementById("top").style.height=height+"px",document.getElementById("top").style.display="",offsetLeft=(1828-1828*c)/2,document.getElementById("top").style.left=(0-offsetLeft)*a+"px",ctx.drawImage(canvasimg,offsetLeft,0,1828*c,1080,0,0,width,height),ratio=a}else b=height/ratio/1080,offsetLeft=0,document.getElementById("top").style.width=width+"px",document.getElementById("top").style.height=height/b+"px",document.getElementById("top").style.display="",document.getElementById("top").style.left="0px",ctx.drawImage(canvasimg,0,0,1828,1080*b,0,0,width,height);texture=ctx.getImageData(0,0,width,height),ripple=ctx.getImageData(0,0,width,height);for(var d=0;d<size;d++)last_map[d]=ripplemap[d]=0;topBorder=820*ratio,bottomBorder=1030*b*ratio,leftBorder=Math.max(100-offsetLeft,35)*ratio,rightBorder=(1750-2*offsetLeft)*ratio,fish1Elem=document.getElementById("fish1"),fish2Elem=document.getElementById("fish2"),fish1Left=Math.max(500-offsetLeft,100)*ratio,fish1Top=850*ratio,fish1Elem.width=40*ratio,fish1Elem.height=20*ratio,fish1Elem.style.left=fish1Left+"px",fish1Elem.style.top=fish1Top+"px",fish1Elem.style.display="",fish2Left=Math.max(1e3-offsetLeft,100)*ratio,fish2Top=880*ratio,fish2Elem.width=50*ratio,fish2Elem.height=25*ratio,fish2Elem.style.left=fish2Left+"px",fish2Elem.style.top=fish2Top+"px",fish2Elem.style.webkitTransform="rotate(180deg)",fish2Elem.style.MozTransform="rotate(180deg)",fish2Elem.style.transform="rotate(180deg)",fish2Elem.style.display="",initMist(Math.max(512-offsetLeft)*ratio,(1532-offsetLeft)*ratio,728*ratio,760*ratio,55*ratio,250),initRain(Math.max(300-offsetLeft,0)*ratio,(1800-2*offsetLeft)*ratio,0*ratio,720*ratio,2e3,2*ratio),run()}function onResize(){fish1Left/=ratio,fish1Top/=ratio,fish2Left/=ratio,fish2Top/=ratio,initCanvas()}function toggleAnim(a){a?(document.getElementById("bodyCanvas").style.visibility="",document.getElementById("fish1").style.visibility="",document.getElementById("fish2").style.visibility="",onResize()):(runRequestId&&window.cancelAnimationFrame(runRequestId),document.getElementById("bodyCanvas").style.visibility="hidden",document.getElementById("fish1").style.visibility="hidden",document.getElementById("fish2").style.visibility="hidden")}angular.module("indexApp",["ui.bootstrap","ui.toggle","ngAnimate","ui.router","ngMaterial"]),angular.module("indexApp").config(function(a,b){b.otherwise("/"),a.state({name:"gamesIndex",url:"/",templateUrl:"gamesList.html"}),a.state({name:"racing",url:"/racing",templateUrl:"views/racing/racing.html",controller:"racingCtrl as racing"}),a.state({name:"racing.garage",url:"/garage",templateUrl:"views/racing/racingGarage.html",onEnter:function(a){a.$broadcast("loadRacingGarage")}}),a.state({name:"racing.store",url:"/store",templateUrl:"views/racing/racingStore.html"}),a.state({name:"racing.upgrades",url:"/upgrades",templateUrl:"views/racing/racingUpgrades.html",onEnter:function(a){a.$broadcast("loadRacingUpgrade")}}),a.state({name:"racing.setup",url:"/raceSetup",templateUrl:"views/racing/racingSetup.html"}),a.state({name:"racing.userRace",url:"/userRace",templateUrl:"views/racing/userRace.html",controller:"userRaceCtrl",controllerAs:"userRace"}),a.state({name:"racing.spectateRace",url:"/spectateRace",templateUrl:"views/racing/spectateRace.html",controller:"spectateRaceCtrl",controllerAs:"spectateRace"}),a.state({name:"snake",url:"/snake",templateUrl:"views/snake/snake.html",controller:"snakeCtrl",controllerAs:"snakeVM"}),a.state({name:"battleship",url:"/battleship",templateUrl:"views/battleship/battleshipList.html",controller:"battleshipListCtrl",controllerAs:"battleshipList"})}),angular.module("indexApp").controller("aboutCtrl",[function(){var a=this;a.javaExperience={percent:80,desc:"Advanced"},a.jsExperience={percent:85,desc:"Advanced"},a.sqlExperience={percent:65,desc:"Proficient"},a.unixExperience={percent:45,desc:"Proficient"},a.cssExperience={percent:69,desc:"Proficient"},a.toolsExperience={percent:50,desc:"Proficient"}}]),angular.module("indexApp").controller("indexCtrl",["$rootScope","$window","identityService",function(a,b,c){var d=this;a.identity={},d.initController=function(){d.animationsToggle=!1,d.homeTabSelected=!0,c.getIdentity().then(function(c){a.identity=c,d.animationsToggle=!0,b.addEventListener("resize",function(a){d.animationsToggle&&d.homeTabSelected&&onResize()}),toggleAnim(d.homeTabSelected)})},d.toggleAnim=function(){toggleAnim(d.animationsToggle)},d.selectHome=function(a){d.homeTabSelected=a,d.homeTabSelected?d.toggleAnim():toggleAnim(!1)},d.initController()}]);var particles=[],particleCount,maxVelocity=2,targetFPS=40,canvasWidth,canvasHeight,leftBound,rightBound,topBound,bottomBound,size,context,rctx,w,h,init,maxParts,rainParticles,rlb,rtb,runRequestId,runInterval,fishInterval,waterfallInterval,fish1Left=500,fish1Top=850,fish2Left=1e3,fish2Top=880,fish1Elem,fish2Elem,goingRight1=!0,goingRight2=!1,fish1Direction="straight",fish2Direction="straight",ratio=1,canvas,ctx,topBorder,bottomBorder,leftBorder,rightBorder,riprad=1,ripplemap=[],last_map=[],width,height,half_width,half_height,size,delay=30,oldind,newind,ripple,texture,line_width=10,step=2*line_width,count,canvasimg=new Image,offsetLeft=0;canvasimg.src="img/misc/bottom.jpg",angular.module("indexApp").factory("commonService",["$http","$q","$uibModal","$log",function(a,b,c,d){return{openConfirmModal:function(a,d){var e=b.defer();return c.open({animation:!0,templateUrl:"templates/confirm.html",controller:function(a,b,c){var d=this;d.title=b,d.message=c,d.ok=function(){a.close(!0)},d.cancel=function(){a.close(!1)}},controllerAs:"modalCtrl",resolve:{title:function(){return a},message:function(){return d}}}).result.then(function(a){e.resolve(a)}),e.promise},openAlertModal:function(a,d){var e=b.defer();return c.open({animation:!0,templateUrl:"templates/alert.html",controller:function(a,b,c){var d=this;d.title=b,d.message=c,d.ok=function(){a.dismiss}},controllerAs:"modalCtrl",resolve:{title:function(){return a},message:function(){return d}}}).result.then(function(a){e.resolve(a)}),e.promise},alertError:function(a){openAlertModal("Error",a.resultMessage)}}}]),angular.module("indexApp").factory("identityService",["$http","$q","$uibModal","$log",function(a,b,c,d){return{getIdentity:function(){var c=b.defer();return a.get("getIdentity").then(function(a){c.resolve(a.data)},function(a){d.error("Error in identityService.getIdentity",a),c.reject(a)}),c.promise},openLoadUserModal:function(){var e=b.defer();return c.open({animation:!0,templateUrl:"templates/loadUser.html",controller:function(b){var c=this;c.execute=function(){var e={params:{username:c.username,password:c.password}};a.get("loadUser",e).then(function(a){b.close(a.data)},function(a){d.error("Failed loadUser",a),c.resultMessage=a.data})},c.cancel=function(){b.dismiss()}},controllerAs:"modalCtrl"}).result.then(function(a){e.resolve(a)}),e.promise},openCreateUserModal:function(){var e=b.defer();return c.open({animation:!0,templateUrl:"templates/createUser.html",controller:function(b){var c=this;c.execute=function(){var e={params:{username:c.username}};a.get("createUser",e).then(function(a){b.close(a.data)},function(a){d.error("Failed saveUser",a),c.resultMessage=a.data})},c.cancel=function(){b.dismiss()}},controllerAs:"modalCtrl"}).result.then(function(a){e.resolve(a)}),e.promise},logout:function(){var c=b.defer();return a.get("logout").then(function(){c.resolve(!0)},function(a){d("Could not logout",a),c.resolve(!1)}),c.promise}}}]);